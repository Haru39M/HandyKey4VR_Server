<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HandyKey4VR Evaluation</title>
    <!-- CSS読み込み -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="container">
        <h1>HandyKey4VR Evaluation</h1>

        <!-- ==========================================
             実験設定エリア
             ========================================== -->
        <div id="config-section" class="config-box">
            <div class="config-item">
                <label for="participant-id">ID:</label>
                <input type="text" id="participant-id" value="p01" size="8">
            </div>
            <!-- Debug Mode 追加 -->
            <div class="config-item">
                <label><input type="checkbox" id="debug-mode"> Debug</label>
            </div>
            <!-- Handedness 追加 -->
            <div class="config-item">
                <label>Hand: 
                    <select id="handedness">
                        <option value="" disabled selected>Select</option>
                        <option value="R">Right</option>
                        <option value="L">Left</option>
                    </select>
                </label>
            </div>
            <div class="config-item">
                <label for="condition">Cond:</label>
                <select id="condition">
                    <option value="" disabled selected>Select</option>
                    <option value="Keyboard">Keyboard</option>
                    <option value="Controller">Controller</option>
                    <option value="Proposed">Proposed</option>
                </select>
            </div>
            <div class="config-item">
                <label for="max-sentences">Sentences:</label>
                <input type="number" id="max-sentences" value="5" size="5">
            </div>
            <!-- 初期状態は disabled -->
            <button id="start-test-btn" type="button" disabled style="background-color: #ccc; cursor: not-allowed;">START TEST</button>
        </div>

        <!-- ==========================================
             タイピングテスト進行エリア (初期は非表示)
             ========================================== -->
        <div id="test-section" class="test-container" style="display:none;">
            <!-- 次へボタン (完了時に表示) -->
            <div class="test-controls" style="text-align: right; margin-bottom: 10px;">
                <button id="next-phrase-btn" style="display:none;">Next Phrase &gt;</button>
            </div>

            <!-- 正解文表示 -->
            <div id="reference-display" class="reference-box">
                <div class="label">Reference Text:</div>
                <div id="reference-text-content" class="text-content"></div>
            </div>

            <!-- ユーザー入力状況表示 -->
            <div id="progress-display" class="progress-box">
                <div class="label">Your Input:</div>
                <div id="progress-text-content" class="text-content"></div>
            </div>

            <!-- 完了メッセージ -->
            <div id="completion-message" style="display:none; color: green; font-weight: bold; margin-top: 10px; text-align: center;">
                Perfect! Loading next...
            </div>
        </div>

        <hr>

        <!-- ==========================================
             入力フォーム & 候補表示
             ========================================== -->
        <form id="predict-form" onsubmit="return false;">
            <label for="word-input">Input:</label>
            <div class="input-wrapper">
                <!-- 入力欄 -->
                <input type="text" id="word-input" name="prefix" autocomplete="off" placeholder="Type here..." disabled>
                
                <!-- 補助ボタン (スマホ用等) -->
                <div class="selection-controls">
                    <button type="button" id="btn-up" tabindex="-1">←</button>
                    <button type="button" id="btn-down" tabindex="-1">→</button>
                    <button type="button" id="btn-confirm" tabindex="-1">Enter</button>
                </div>
            </div>

            <!-- 候補をここ（入力欄の下）に横並びで表示 -->
            <div id="horizontal-candidates" class="candidates-row">
                <!-- JSで候補アイテム(div)が挿入されます -->
            </div>
        </form>

        <!-- ==========================================
             キーボード表示
             ========================================== -->
        <div id="keyboard-container">
            <div class="keyboard-row">
                <div class="key key-q" data-key="q">Q <span class="index-label" data-char="q"></span></div>
                <div class="key key-w" data-key="w">W <span class="index-label" data-char="w"></span></div>
                <div class="key key-e" data-key="e">E <span class="index-label" data-char="e"></span></div>
                <div class="key key-r" data-key="r">R <span class="index-label" data-char="r"></span></div>
                <div class="key key-t" data-key="t">T <span class="index-label" data-char="t"></span></div>
                <div class="key key-y" data-key="y">Y <span class="index-label" data-char="y"></span></div>
                <div class="key key-u" data-key="u">U <span class="index-label" data-char="u"></span></div>
                <div class="key key-i" data-key="i">I <span class="index-label" data-char="i"></span></div>
                <div class="key key-o" data-key="o">O <span class="index-label" data-char="o"></span></div>
                <div class="key key-p" data-key="p">P <span class="index-label" data-char="p"></span></div>
            </div>
            <div class="keyboard-row">
                <div class="key key-a" data-key="a">A <span class="index-label" data-char="a"></span></div>
                <div class="key key-s" data-key="s">S <span class="index-label" data-char="s"></span></div>
                <div class="key key-d" data-key="d">D <span class="index-label" data-char="d"></span></div>
                <div class="key key-f" data-key="f">F <span class="index-label" data-char="f"></span></div>
                <div class="key key-g" data-key="g">G <span class="index-label" data-char="g"></span></div>
                <div class="key key-h" data-key="h">H <span class="index-label" data-char="h"></span></div>
                <div class="key key-j" data-key="j">J <span class="index-label" data-char="j"></span></div>
                <div class="key key-k" data-key="k">K <span class="index-label" data-char="k"></span></div>
                <div class="key key-l" data-key="l">L <span class="index-label" data-char="l"></span></div>
            </div>
            <div class="keyboard-row">
                <div class="key key-z" data-key="z">Z <span class="index-label" data-char="z"></span></div>
                <div class="key key-x" data-key="x">X <span class="index-label" data-char="x"></span></div>
                <div class="key key-c" data-key="c">C <span class="index-label" data-char="c"></span></div>
                <div class="key key-v" data-key="v">V <span class="index-label" data-char="v"></span></div>
                <div class="key key-b" data-key="b">B <span class="index-label" data-char="b"></span></div>
                <div class="key key-n" data-key="n">N <span class="index-label" data-char="n"></span></div>
                <div class="key key-m" data-key="m">M <span class="index-label" data-char="m"></span></div>
            </div>
        </div>

        <!-- ==========================================
             ハンドガイド画像 (新規追加)
             ========================================== -->
        <div id="hands-container">
            <img src="{{ url_for('static', filename='hands_guide.png') }}" alt="Finger Guide">
        </div>
        
        <div id="info-container"></div>
    </div>

    <!-- Pythonから渡される変数の定義 -->
    <script>
        const REVERSE_QWERTY_MAP = {{ js_reverse_map| safe }};
    </script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>